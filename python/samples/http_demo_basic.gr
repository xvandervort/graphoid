# Basic HTTP Client Demo
# Demonstrates fundamental HTTP operations using Glang's HTTP module

import "http"

print("ğŸŒ Basic HTTP Client Demo")
print("========================")

# Test 1: Check if network is available
print("\nğŸ” Checking network availability...")
if http.is_available() {
    print("âœ… Network functionality is available")
} else {
    print("âŒ Network functionality is not available")
    print("âš ï¸  Demo cannot continue without network")
}

# Only continue if network is available
if http.is_available() {

# Test 2: Simple GET request
print("\nğŸ“¡ Making a simple GET request...")
url = "https://httpbin.org/json"
response = http.get(url)

print("ğŸ“Š Response details:")
print("  Status: " + response["status"].to_string())
print("  Success: " + response["success"].to_string())
print("  Body length: " + response["body"].length().to_string() + " characters")

if response["success"] {
    print("âœ… GET request successful!")
} else {
    print("âŒ GET request failed")
}

# Test 3: GET request with custom headers
print("\nğŸ·ï¸ Making GET request with custom headers...")
headers = { "User-Agent": "Glang-HTTP-Demo/1.0", "Accept": "application/json" }
response_with_headers = http.get(url, headers)

print("ğŸ“Š Response with headers:")
print("  Status: " + response_with_headers["status"].to_string())
print("  Success: " + response_with_headers["success"].to_string())

if response_with_headers["success"] {
    print("âœ… GET request with headers successful!")
}

# Test 4: POST request with data
print("\nğŸ“¤ Making POST request with data...")
post_url = "https://httpbin.org/post"
post_data = "name=Alice&age=25&city=NewYork"
post_response = http.post(post_url, post_data)

print("ğŸ“Š POST response:")
print("  Status: " + post_response["status"].to_string())
print("  Success: " + post_response["success"].to_string())

if post_response["success"] {
    print("âœ… POST request successful!")
    body = post_response["body"]
    if body.contains("Alice") {
        print("ğŸ¯ Server received our data correctly!")
    }
}

# Test 5: Custom HTTP method (PUT)
print("\nğŸ”„ Making PUT request...")
put_data = "updated_value=123"
put_response = http.request("PUT", post_url, put_data)

print("ğŸ“Š PUT response:")
print("  Status: " + put_response["status"].to_string())
print("  Success: " + put_response["success"].to_string())

if put_response["success"] {
    print("âœ… PUT request successful!")
}

# Test 6: Error handling - invalid URL
print("\nâš ï¸ Testing error handling with invalid URL...")
error_response = http.get("https://this-domain-does-not-exist-12345.com")

print("ğŸ“Š Error response:")
print("  Status: " + error_response["status"].to_string())
print("  Success: " + error_response["success"].to_string())

if error_response["success"] == false {
    print("âœ… Error handling works correctly!")
}

# Test 7: Response headers inspection
print("\nğŸ” Inspecting response headers...")
if response["success"] {
    headers = response["headers"]
    if headers.has_key("content-type") {
        content_type = headers["content-type"]
        print("ğŸ“„ Content-Type: " + content_type.to_string())
    }
    if headers.has_key("server") {
        server = headers["server"]
        print("ğŸ–¥ï¸ Server: " + server.to_string())
    }
}

    print("\nâœ¨ Basic HTTP demo completed!")
    print("ğŸ¯ All HTTP client features are working correctly!")
    print("\nğŸ“– Key features demonstrated:")
    print("  âœ“ GET requests (simple and with headers)")
    print("  âœ“ POST requests with data")
    print("  âœ“ Custom HTTP methods (PUT)")
    print("  âœ“ Error handling")
    print("  âœ“ Response header inspection")
    print("  âœ“ Network availability checking")
}