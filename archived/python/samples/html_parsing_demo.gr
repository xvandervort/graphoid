# HTML Parsing Library Demo
# Showcases the powerful HTML parsing capabilities of Glang
# Demonstrates advanced querying, extraction, and Unicode support

import "html_parser" as html

print("ğŸŒ Glang HTML Parsing Library Demo")
print("==================================")
print("âœ¨ Advanced HTML parsing with Unicode support")

# Sample HTML content for demonstration (simplified version)
string sample_html = "<html><head><meta name=\"description\" content=\"Sample page with Bitcoin price: $67,891.23 USD\"><title>Crypto Prices</title></head><body><div class=\"header\"><h1>Cryptocurrency Market</h1><nav><a href=\"/bitcoin\">Bitcoin</a><a href=\"/ethereum\">Ethereum</a></nav></div><div class=\"main-content\"><div class=\"price-card\" data-symbol=\"BTC\"><h2>Bitcoin (BTC)</h2><span class=\"price\">$67,891.23</span><p>The leading cryptocurrency ğŸš€</p></div><div class=\"price-card\" data-symbol=\"ETH\"><h2>Ethereum (ETH)</h2><span class=\"price\">$3,456.78</span><p>Smart contract platform ğŸŒŸ</p></div><div class=\"news-section\"><h3>Latest News</h3><article data-id=\"1\"><h4>Bitcoin reaches new heights</h4><p>Bitcoin price surged to $67,891 today</p><img src=\"bitcoin-chart.png\" alt=\"Bitcoin price chart\"></article></div></div><footer><p>Contact: support@crypto-prices.com</p></footer></body></html>"

print("\nğŸ” Step 1: Parse HTML Content")
print("============================")
elements = html.parse(sample_html)
print("âœ… Successfully parsed HTML")
print("ğŸ“Š Root elements found: " + elements.size().to_string())

print("\nğŸ¯ Step 2: Find Elements by Tag")
print("===============================")
# Find all price spans
price_spans = html.find_by_tag(elements, "span")
print("ğŸ’° Found " + price_spans.size().to_string() + " span elements")

# Find all links
links = html.find_by_tag(elements, "a")
print("ğŸ”— Found " + links.size().to_string() + " link elements")

print("\nğŸ“ Step 3: Extract Links Information")
print("====================================")
all_links = html.extract_links(elements)
for link in all_links {
    url_data = link["url"]
    text_data = link["text"]
    print("ğŸ”— Link: '" + text_data.value + "' -> " + url_data.value)
}

print("\nğŸ–¼ï¸ Step 4: Extract Images Information")
print("=====================================")
all_images = html.extract_images(elements)
for image in all_images {
    src_data = image["src"]
    alt_data = image["alt"]
    print("ğŸ–¼ï¸ Image: " + src_data.value + " (alt: '" + alt_data.value + "')")
}

print("\nğŸ” Step 5: Find Elements by Class")
print("=================================")
price_cards = html.find_by_class(elements, "price-card")
print("ğŸ’³ Found " + price_cards.size().to_string() + " price cards")

for card in price_cards {
    card_info = html.get_element_info(card)
    symbol = html.get_attribute(card, "data-symbol")
    print("ğŸ“Š Card: " + symbol + " - " + card_info["child_count"].to_string() + " children")
}

print("\nğŸ” Step 6: Find Elements by Attribute")
print("=====================================")
# Find elements with data-symbol attribute
crypto_elements = html.find_by_attribute(elements, "data-symbol")
print("ğŸª™ Found " + crypto_elements.size().to_string() + " elements with data-symbol")

# Find specific Bitcoin element
bitcoin_elements = html.find_by_attribute(elements, "data-symbol", "BTC")
print("â‚¿ Found " + bitcoin_elements.size().to_string() + " Bitcoin-specific elements")

print("\nğŸ’¬ Step 7: Find Elements Containing Text")
print("========================================")
# Find elements mentioning Bitcoin
bitcoin_mentions = html.find_containing_text(elements, "Bitcoin")
print("â‚¿ Found " + bitcoin_mentions.size().to_string() + " elements mentioning Bitcoin")

# Find elements with price information
price_mentions = html.find_containing_text(elements, "$")
print("ğŸ’° Found " + price_mentions.size().to_string() + " elements with price information")

# Test Unicode text search
emoji_elements = html.find_containing_text(elements, "ğŸš€")
print("ğŸš€ Found " + emoji_elements.size().to_string() + " elements with rocket emoji")

print("\nğŸ“Š Step 8: Extract and Clean Text")
print("=================================")
if price_cards.size() > 0 {
    first_card = price_cards[0]
    card_info = html.get_element_info(first_card)

    raw_text = card_info["raw_text"]
    clean_text = card_info["text"]

    print("ğŸ“ Raw text length: " + raw_text.length().to_string())
    print("ğŸ§¹ Clean text length: " + clean_text.length().to_string())
    print("âœ¨ Clean text: '" + clean_text + "'")
}

print("\nğŸ” Step 9: Advanced Price Extraction")
print("====================================")
# Extract all price information using multiple strategies
all_prices = []

# Strategy 1: Find elements with "price" class
price_elements = html.find_by_class(elements, "price")
for element in price_elements {
    element_info = html.get_element_info(element)
    text = element_info["text"]
    print("ğŸ’° Price element text: " + text)
    all_prices.append(text)
}

# Strategy 2: Find meta description with price
meta_elements = html.find_by_tag(elements, "meta")
for meta in meta_elements {
    content = html.get_attribute(meta, "content")
    if content.contains("price") and content.contains("$") {
        print("ğŸ“‹ Meta description price: " + content)
        all_prices.append(content)
    }
}

print("ğŸ’° Total prices found: " + all_prices.size().to_string())

print("\nğŸŒŸ Step 10: Unicode and Emoji Handling")
print("======================================")
# Test Unicode text extraction
unicode_elements = html.find_containing_text(elements, "ğŸ’°")
for element in unicode_elements {
    element_info = html.get_element_info(element)
    print("ğŸŒŸ Unicode text: " + element_info["text"])
    print("ğŸ“Š Element tag: " + element_info["tag"])
}

print("\nğŸ“ˆ Step 11: Data Analysis Summary")
print("=================================")
print("ğŸ“Š HTML Parsing Results:")
print("  ğŸ·ï¸ Total elements parsed: " + elements.size().to_string())
print("  ğŸ”— Links found: " + all_links.size().to_string())
print("  ğŸ–¼ï¸ Images found: " + all_images.size().to_string())
print("  ğŸ’³ Price cards: " + price_cards.size().to_string())
print("  ğŸª™ Crypto symbols: " + crypto_elements.size().to_string())
print("  ğŸ’° Price mentions: " + price_mentions.size().to_string())
print("  ğŸš€ Emoji elements: " + emoji_elements.size().to_string())

print("\nâœ¨ Demo completed successfully!")
print("ğŸŒŸ Glang HTML parsing library provides:")
print("  ğŸ” Comprehensive element finding")
print("  ğŸ¯ Advanced text extraction")
print("  ğŸŒ Unicode and emoji support")
print("  ğŸ“Š Rich element information")
print("  ğŸ› ï¸ Multiple extraction strategies")
print("  ğŸ§¹ Automatic text cleaning")

print("\nğŸš€ Ready for real-world web scraping!")